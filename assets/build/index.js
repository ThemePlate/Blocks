(()=>{"use strict";var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var n in l)e.o(l,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:l[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.blocks,l=window.React,n=window.wp.blockEditor,a=window.wp.data,r=window.wp.element,o=window.wp.hooks,c=window.wp.serverSideRender;var s=e.n(c);const i=window.ThemePlate_Blocks||{ajax_url:"",_wpnonce:"",collection:{},locations:[]},u=window.wp.i18n,m=window.wp.components,p=(e,t,a)=>{const[o,c]=(0,r.useState)(!1);switch(e.type){default:case"text":case"time":case"email":case"url":case"date":case"number":return(0,l.createElement)(m.TextControl,{type:e.type,label:e.title,help:e?.help||"",value:t[e.key],onChange:t=>a({[e.key]:t})});case"textarea":return(0,l.createElement)(m.TextareaControl,{label:e.title,help:e?.help||"",value:t[e.key],onChange:t=>a({[e.key]:t})});case"select":case"select2":return(0,l.createElement)(m.SelectControl,{label:e.title,help:e?.help||"",value:t[e.key],options:e.options,multiple:e.multiple,onChange:t=>a({[e.key]:t})});case"radiolist":case"radio":return(0,l.createElement)(m.RadioControl,{label:e.title,help:e?.help||"",selected:t[e.key],options:e.options,onChange:t=>a({[e.key]:t})});case"checklist":case"checkbox":return(0,l.createElement)(m.BaseControl,{help:e?.help||""},(0,l.createElement)(m.BaseControl.VisualLabel,null,e.title),0===e.options.length&&(0,l.createElement)(m.CheckboxControl,{checked:"true"===t[e.key],onChange:t=>a({[e.key]:t.toString()})}),0!==e.options.length&&(0,l.createElement)(r.Fragment,null,e.options.map((n=>(0,l.createElement)(m.CheckboxControl,{key:n.value,label:n.label,checked:t[e.key].includes(n.value),onChange:l=>{a({[e.key]:e.options.filter((({value:a})=>n.value!==a?t[e.key].includes(a):l)).map((({value:e})=>e))})}})))));case"color":return(0,l.createElement)(m.BaseControl,{help:e?.help||""},(0,l.createElement)(m.BaseControl.VisualLabel,null,e.title),(0,l.createElement)(r.Fragment,null,(0,l.createElement)(m.Flex,{gap:4,align:"flex-start",justify:"flex-start"},(0,l.createElement)(m.FlexItem,null,(0,l.createElement)(m.Button,{variant:"secondary",onClick:()=>c(!0)},"Pick")),(0,l.createElement)(m.FlexItem,null,(0,l.createElement)(m.ColorIndicator,{colorValue:t[e.key],className:"themeplate-color-indicator"}))),o&&(0,l.createElement)(m.Modal,{focusOnMount:!0,shouldCloseOnEsc:!0,shouldCloseOnClickOutside:!0,title:(0,u.__)("Insert/edit color"),onRequestClose:()=>c(!1)},(0,l.createElement)(m.ColorPicker,{color:t[e.key],onChange:t=>a({[e.key]:t}),enableAlpha:!0}))));case"range":return(0,l.createElement)(m.RangeControl,{label:e.title,help:e?.help||"",value:parseInt(t[e.key]),onChange:t=>a({[e.key]:t.toString()}),afterIcon:(0,l.createElement)("strong",null,t[e.key]),withInputField:!1});case"html":return(0,l.createElement)(r.RawHTML,null,t[e.key]);case"group":return(0,l.createElement)(m.BaseControl,{help:e?.help||""},(0,l.createElement)(m.BaseControl.VisualLabel,null,e.title),(0,l.createElement)(d,{list:e.fields,attributes:t[e.key],setAttributes:l=>{a({[e.key]:{...t[e.key],...l}})}}));case"link":return(0,l.createElement)(m.BaseControl,{help:e?.help||""},(0,l.createElement)(m.BaseControl.VisualLabel,null,e.title),(0,l.createElement)(r.Fragment,null,(0,l.createElement)(m.Flex,{gap:6,align:"center",justify:"flex-start"},(0,l.createElement)(m.FlexItem,null,(0,l.createElement)(m.Button,{variant:"secondary",onClick:()=>c(!0)},"Select")),(0,l.createElement)(m.FlexItem,null,(0,l.createElement)(m.ExternalLink,{href:t[e.key].url},t[e.key].title))),o&&(0,l.createElement)(m.Modal,{focusOnMount:!0,shouldCloseOnEsc:!0,shouldCloseOnClickOutside:!0,title:(0,u.__)("Insert/edit link"),onRequestClose:()=>c(!1)},(0,l.createElement)(m.TextControl,{type:"text",label:(0,u.__)("Link text"),value:t[e.key].text,onChange:l=>a({[e.key]:{...t[e.key],title:l,text:l}})}),(0,l.createElement)(n.__experimentalLinkControl,{value:t[e.key],onChange:t=>a({[e.key]:{...t,text:t.title}})}))));case"file":const s=(e.multiple?t[e.key]:[t[e.key]]).filter((e=>!!e.id));return(0,l.createElement)(m.BaseControl,null,(0,l.createElement)(m.BaseControl.VisualLabel,null,e.title),(0,l.createElement)(n.MediaUpload,{label:e.title,multiple:e.multiple,value:e.multiple?t[e.key].map((({id:e})=>e)):t[e.key].id,onSelect:t=>{const l=Array.isArray(t)?t.map((({id:e,url:t,title:l,type:n,icon:a})=>({id:e,url:t,title:l,type:n,icon:a}))):{id:t.id,url:t.url,title:t.title,type:t.type,icon:t.icon};a({[e.key]:l})},render:({open:t})=>(0,l.createElement)(m.Flex,{gap:4,wrap:!0},(0,l.createElement)(m.FlexItem,{isBlock:!0},(0,l.createElement)(m.Button,{variant:"secondary",onClick:t},(0,u.__)("Select"))),s.length>=1&&(0,l.createElement)(m.FlexItem,{isBlock:!1},(0,l.createElement)(m.Button,{variant:"secondary",onClick:()=>{a({[e.key]:e.multiple?[]:""})}},e.multiple&&s.length>1?(0,u.__)("Clear"):(0,u.__)("Remove"))),(0,l.createElement)(m.Flex,{gap:4,direction:"column"},s.map((({url:e,title:t,type:n,icon:a},r)=>(0,l.createElement)(m.FlexItem,{key:r,isBlock:!0},(0,l.createElement)(m.Card,null,(0,l.createElement)(m.CardMedia,null,(0,l.createElement)("img",{className:"themeplate-image",src:"image"===n?e:a,alt:t})),(0,l.createElement)(m.CardFooter,null,t)))))))}));case"editor":case"type":case"post":case"page":case"user":case"term":return(0,l.createElement)(m.BaseControl,{help:e?.help||""},(0,l.createElement)(m.BaseControl.VisualLabel,null,e.title),(0,l.createElement)(m.Tip,null,(0,l.createElement)("strong",null,"TODO!")," Field"," ",(0,l.createElement)("code",null,e.type)))}};function d(e){const{list:t,attributes:n,setAttributes:a}=e;return(0,l.createElement)(r.Fragment,null,t.map((e=>(0,l.createElement)(m.PanelRow,{key:e.key,className:["themeplate-blocks-field",`field-${e.class}`]},p(e,n,a)))))}function k(e){const{queried:t,fields:a,attributes:o,setAttributes:c}=e;return t?(0,l.createElement)(r.Fragment,null,i.locations.map((e=>(0,l.createElement)(r.Fragment,{key:e},0!==a[e].length&&(0,l.createElement)(n.InspectorControls,{group:e},(0,l.createElement)(r.Fragment,null,"advanced"!==e&&(0,l.createElement)(m.PanelBody,{title:(0,u.__)("Control Fields")},(0,l.createElement)(d,{list:a[e],attributes:o,setAttributes:c}))||(0,l.createElement)(r.Fragment,null,(0,l.createElement)(d,{list:a[e],attributes:o,setAttributes:c}),(0,l.createElement)(m.PanelRow,{className:["themeplate-blocks-field","field-type-separator"]})))))))):(0,l.createElement)(n.InspectorControls,null,(0,l.createElement)(m.Placeholder,null,(0,l.createElement)(m.Spinner,null)))}const E="block-editor-server-side-render";function h(e){const t=(0,r.useRef)(),c=(0,r.useRef)(),[u,m]=(0,r.useState)([]),[p,d]=(0,r.useState)(!1),h=(0,n.useBlockProps)({className:"wp-block-themeplate",ref:t}),y=h["data-type"],{attributes:b,setAttributes:C}=e,g=(0,a.useSelect)((t=>t(n.store).getBlock(e.clientId)),[e]),w=i.collection[y],f=w.inner_blocks;return(0,r.useMemo)((()=>{fetch(i.ajax_url,{method:"POST",body:new URLSearchParams({_wpnonce:i._wpnonce,action:"themeplate_blocks_fields",block:y})}).then((e=>e.json())).then((e=>{m(e.data),d(!0)}))}),[y]),(0,r.useEffect)((()=>{const e=new MutationObserver((e=>{if((e=>{if(2!==e.length)return!1;const t=e[1].addedNodes;return 1===t.length&&E===t[0].className})(e)){if(f){const e=t.current.querySelector("ThemePlateInnerBlocks");null===e||e.childNodes.length||e.replaceWith(c.current)}(0,o.doAction)("tpb-rendered",y,t.current,b),(0,o.doAction)(`tpb-rendered-${y.replace(/\//,".")}`,t.current,b)}}));return e.observe(t.current,{childList:!0}),()=>{e.disconnect()}}),[y,f,b]),(0,l.createElement)(r.Fragment,null,(0,l.createElement)(k,{queried:p,fields:u,attributes:b,setAttributes:C}),(0,l.createElement)("div",{...h},(0,l.createElement)(s(),{block:y,attributes:b,className:E}),f&&(0,l.createElement)(n.InnerBlocks,{ref:c,allowedBlocks:w.allowed_blocks,template:w.template_blocks,templateLock:w.template_lock,renderAppender:g?.innerBlocks?.length?null:n.InnerBlocks.ButtonBlockAppender})))}function y(){return(0,l.createElement)(n.InnerBlocks.Content,null)}Object.keys(i.collection).forEach((e=>{(0,t.registerBlockType)(e,{edit:h,save:y})}))})();